
# Setup

```{r libraries}
library(tidyverse)
library(plotly)
library(sf)
library(rnaturalearth)

```

# Importing Full Dataset

```{r}
load("data/met.RData")
```

# Most Common Object Classifiations

## Prepping Data for Analysis

* Filtering to only include objects with a `classification` value, then trying to group objects into specific types.
* This needs to be cleaned up further, as there are still semi-duplicate categories.

```{r}
with_classification = 
  met |> 
  filter(!is.na(classification) & classification != "(not assigned)") |> 
  mutate(
    classification = str_remove(classification, "[-|].*")
  )

with_classification |> 
  group_by(classification) |> 
  summarize(
    classification_n = n()
  ) |> 
  knitr::kable()
  
```

## Plotting the Cumulative Sum of Objects Acquired Over Time, by Classification

* For readability, I limited the plot to only include classifications with more than 3000 total acquisitions by 2023. Without doing this, there are a ton of less common categories hanging out at the very bottom and cluttering up the plot.
* This could be improved by modifying the legend to have the classifications listed by popularity in 2023 in the legend.

```{r}

cumulative_classification = 
  with_classification |> 
  group_by(classification, accession_year) |> 
  summarize(
    count = n()
  ) |> 
  group_by(classification) |> 
  mutate(
    cumulative_count = cumsum(count)
  ) |> 
  arrange(desc(cumulative_count))

most_acquired_classifications =
  cumulative_classification |> 
  group_by(classification) |> 
  arrange(desc(accession_year)) |> 
  filter(row_number() == 1 & cumulative_count > 3000)


cumulative_classification |> 
  filter(classification %in% most_acquired_classifications$classification) |> 
  plot_ly(
    x = ~accession_year, y = ~cumulative_count, type = "scatter", mode = "line", 
    color = ~classification, colors = "viridis") |>
  layout(
    xaxis = list(title = "Year"), 
    yaxis = list(title = "Total Acquired")
  )  

```





```{r, message=FALSE, warning=FALSE}
met <- met |>
  select(department, accession_year, object_name, culture, country, reign, artist_gender, dynasty, is_public_domain) |> 
  mutate_all(~ifelse(. == "", "unknown", .)) |> 
  filter(!is.na(accession_year), accession_year >= 1940, accession_year <= 2023)
```


```{r, message=FALSE, warning=FALSE}

top_years_culture <- met |> 
  group_by(accession_year, object_name, culture) |> 
  summarize(count = n()) |> 
  arrange(desc(count)) |> 
  ungroup() |> 
  top_n(15)

print(top_years_culture)
```

```{r, warning=FALSE, message=FALSE}
country_dist <- met |> 
  group_by(country, accession_year) |> 
  summarize(count = n()) |> 
  arrange(desc(count)) |> 
  ungroup()

print(country_dist)

```


```{r, warning=FALSE}
met <- met |>
  select(department, accession_year, object_name, culture, country) |> 
  mutate_all(~ifelse(. == "", "unknown", .)) |> 
  filter(!is.na(accession_year), accession_year >= 1940, accession_year <= 2023)
```


```{r, message=FALSE, warning=FALSE}
met |>
  group_by(department) |>
  summarize(count = n()) |> 
  arrange(desc(count)) |> 
  knitr::kable(digits = 3)

```

```{r, warning=FALSE}
met |> 
  count(department) |> 
  mutate(department = fct_reorder(department, n)) |> 
  plot_ly(x = ~department, y = ~n, color = ~department, type = "bar", colors = "viridis")
```


```{r, warning=FALSE}
met |> 
  count(object_name) |> 
  top_n(15, n) |> 
  mutate(object_name = fct_reorder(object_name, n)) |> 
  plot_ly(x = ~object_name, y = ~n, color = ~object_name, type = "bar", colors = "viridis")
```

```{r, message=FALSE, warning=FALSE}

object_counts <- met |> 
  group_by(country, object_name) |> 
  summarise(n_objects = n()) |> 
  group_by(country) |> 
  summarise(total_objects = sum(n_objects, na.rm = TRUE))


world <- ne_countries(scale = "medium", returnclass = "sf")

# Merging with world map data
world_data <- left_join(world, object_counts, by = c("name" = "country"))

# Plotting the map
ggplot() +
  geom_sf(data = world_data, aes(fill = total_objects), color = "white", size = 0.2) 

```



