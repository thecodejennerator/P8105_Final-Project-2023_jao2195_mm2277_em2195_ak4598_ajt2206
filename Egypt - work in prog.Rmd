---
title: "Exhibition E: Art Around the World"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    source_code: fill
runtime: shiny
---


Ideas: 
  1. Graphing Accession of Items over Time - coloring them by different dynasties since that gives a rough timeline (maybe also add that to the key) #Done
  2. Graphing the objects by Dynasty - either overall or with a timeline, could look into specific timeline
  3. Graphing the type of objects overtime or the type of objects by dynasty.
  4. Map of Common Sites for things to be found around Egypt - add a lot more info onto this




```{r setup, include=FALSE}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

library(tidyverse)
library(plotly)
library(leaflet)
library(flexdashboard)
library(shiny)
library(sf)
library(ggmap)
```

## Import data

```{r, message = FALSE, warning=FALSE}
load("data/met.RData")
  
met_egypt = met |> 
  filter(department == "Egyptian Art") |> 
  select(object_id, is_highlight, accession_year, object_name, title, period, dynasty, reign, object_date, object_begin_date, object_end_date, medium, credit_line, region, subregion, locale, excavation, tags)
```

## Set color palette based on Wes Anderson package

```{r}
mypal<-c("#78B7C5",  "#EBCC2A", "#FF0000",
         "#3B9AB2", "#B40F20", "#0B775E", "#F2300F", 
         "#5BBCD6", "#F98400", "#ab0213", "#E2D200", 
         "#ff7700", "#46ACC8", "#00A08A", "#78B7C5",
         "#a7ba42", "#f94f8a", "#DD8D29", "#EABE94")
```

## Plot 1: Line chart showing number of objects acquired by department over time

```{r}
met_egypt = met_egypt |> 
 mutate(
    dynasty = case_when(
      dynasty == "11" ~ "Dynasty 11",
      dynasty == "Dynasty 1, 3–4" | dynasty == "Dynasty 1 3-4" ~ "Dynasty Range",
      dynasty == "Dynasty 11, late" ~ "Dynasty 11",
      dynasty == "Dynasty 11?" ~ "Dynasty 11",
      dynasty == "Dynasty 11–13" | dynasty == "Dynasty 11-13" ~ "Dynasty Range",
      dynasty == "Dynasty 11–17" | dynasty == "Dynasty 11-17" ~ "Dynasty Range",
      dynasty == "Dynasty 11-17" ~ "Dynasty Range",
      dynasty == "Dynasty 11–18" ~ "Dynasty Range",
      dynasty == "Dynasty 11–mid 12" | dynasty == "Dynasty 11-mid 12" ~ "Dynasty Range",
      dynasty == "Dynasty 11–12" | dynasty == "Dynasty 11-12" ~ "Dynasty Range",
      dynasty == "Dynasty 12, early" ~ "Dynasty 12",
      dynasty == "Dynasty 12, early – mid" | dynasty == "Dynasty 12, early - mid" ~ "Dynasty 12",
      dynasty == "Dynasty 12, early–mid" | dynasty == "Dynasty 12, early-mid" ~ "Dynasty 12",
      dynasty == "Dynasty 12, late" ~ "Dynasty 12",
      dynasty == "Dynasty 12, late – 13 up to 1700" | dynasty == "Dynasty 12, late - 13 up to 1700" ~ "Dynasty Range",
      dynasty == "Dynasty 12, late-13 up to 1700 B. C." ~ "Dynasty Range",
      dynasty == "Dynasty 12, late–17" ~ "Dynasty Range",
      dynasty == "Dynasty 12, late-17" ~ "Dynasty Range",
      dynasty == "Dynasty 12, mid" ~ "Dynasty 12",
      dynasty == "Dynasty 12–13" ~ "Dynasty 12-13",
      dynasty == "Dynasty 12, late–early 13" ~ "Dynasty 12-13",
      dynasty == "Dynasty 12–17" ~ "Dynasty Range",
      dynasty == "Dynasty 12–18" ~ "Dynasty Range",
      dynasty == "Dynasty 13 to 1700 B.C." ~ "Dynasty Range",
      dynasty == "Dynasty 13, mid" ~ "Dynasty 13",
      dynasty == "Dynasty 13–17" ~ "Dynasty Range",
      dynasty == "Dynasty 13–18, early" ~ "Dynasty Range",
      dynasty == "Dynasty 13–SIP" ~ "Dynasty Range",
      dynasty == "Dynasty 14–15" ~ "Dynasty Range",
      dynasty == "Dynasty 15–17" ~ "Dynasty Range",
      dynasty == "Dynasty 17–early Dynasty 18" ~ "Dynasty 17-18",
      dynasty == "Dynasty 17–Early Dynasty 18" ~ "Dynasty 17-18",
      dynasty == "Dynasty 17–18" ~ "Dynasty 17-18",
      dynasty == "Dynasty 18 (?)" ~ "Dynasty 18",
      dynasty == "Dynasty 18 or later (?)" ~ "Dynasty 18",
      dynasty == "Dynasty 18, early" ~ "Dynasty 18",
      dynasty == "Dynasty 18, late" ~ "Dynasty 18",
      dynasty == "Dynasty 18, possibly later" ~ "Dynasty 18",
      dynasty == "Dynasty 18, second half" ~ "Dynasty 18",
      dynasty == "Dynasty 18–19" | dynasty == "Dynasty 18-19" ~ "Dynasty Range",
      dynasty == "Dynasty 18–20" ~ "Dynasty Range",
       dynasty == "Dynasty 19–20" ~ "Dynasty 19-20",
      dynasty == "Dynasty 19–20 (Ramesside)" ~ "Dynasty 19-20",
      dynasty == "Dynasty 19–20 or later (?)" ~ "Dynasty 19-20",
      dynasty == "Dynasty 19–21" ~ "Dynasty Range",
      dynasty == "Dynasty 19–25" ~ "Dynasty Range",
      dynasty == "Dynasty 19–30" ~ "Dynasty Range",
      dynasty == "Dynasty 1–2" ~ "Dynasty Range", 
      dynasty == "Dynasty 1-2" ~ "Dynasty Range",
      dynasty == "Dynasty 2, second half" ~ "Dynasty 2",
      dynasty == "Dynasty 20 (Ramesside)" ~ "Dynasty 2",
      dynasty == "Dynasty 20 or later" ~ "Dynasty 20",
      dynasty == "Dynasty 20–21" | dynasty == "Dynasty 20-21" ~ "Dynasty Range",
      dynasty == "Dynasty 20–22" ~ "Dynasty Range",
      dynasty == "Dynasty 20–26" ~ "Dynasty Range",
      dynasty == "Dynasty 21 (?)" ~ "Dynasty 21",
      dynasty == "Dynasty 21 or 22" ~ "Dynasty Range",
      dynasty == "Dynasty 21–22" ~ "Dynasty Range",
      dynasty == "Dynasty 21-22" ~ "Dynasty Range",
      dynasty == "Dynasty 21–24" ~ "Dynasty Range",
      dynasty == "Dynasty 21–25" ~ "Dynasty Range",
      dynasty == "Dynasty 21–26" ~ "Dynasty Range",
      dynasty == "Dynasty 21–30" ~ "Dynasty Range",
      dynasty == "Dynasty 21–early Dynasty 22" ~ "Dynasty 21-22",
      dynasty == "Dynasty 22, early" ~ "Dynasty 22",
      dynasty == "Dynasty 22–24" ~ "Dynasty Range",
      dynasty == "Dynasty 22–26" ~ "Dynasty Range",
      dynasty == "Dynasty 25-26" ~ "Dynasty Range",
      dynasty == "Dynasty 25–26" ~ "Dynasty Range",
      dynasty == "Dynasty 25 (Kushite)" ~ "Dynasty 25",
      dynasty == "Dynasty 25–30" ~ "Dynasty Range",
      dynasty == "Dynasty 26 (Saite)" ~ "Dynasty 26",
      dynasty == "Dynasty 26 and later" ~ "Dynasty Range",
      dynasty == "Dynasty 26 or later" ~ "Dynasty Range",
      dynasty == "Dynasty 26–29" ~ "Dynasty Range",
      dynasty == "Dynasty 26–4th century" ~ "Dynasty Range",
      dynasty == "Dynasty 26–30" ~ "Dynasty Range",
      dynasty == "Dynasty 3–4" | dynasty == "Dynasty 3-4"  ~ "Dynasty Range",
      dynasty == "Dynasty 27–30" ~ "Dynasty Range",
      dynasty == "Dynasty 27–30?" ~ "Dynasty Range",
      dynasty == "Dynasty 30 or later" ~ "Dynasty 30",
      dynasty == "Dynasty 5 (?)" ~ "Dynasty 5",
      dynasty == "Dynasty 5, second half" ~ "Dynasty 5",
      dynasty == "Dynasty 5-6" ~ "Dynasty Range",
      dynasty == "Dynasty 5–6" ~ "Dynasty Range",
      dynasty == "Dynasty 6–8" ~ "Dynasty Range",
      dynasty == "Dynasty 6-8" ~ "Dynasty Range",
      dynasty == "Dynasty 6–11" ~ "Dynasty Range",
      dynasty == "Dynasty 6–12" ~ "Dynasty 2",
      dynasty == "Dynasty 7–10 (?)" ~ "Dynasty Range",
      dynasty == "Dynasty 8–11" ~ "Dynasty Range",
      dynasty == "Dynasty 8–12" ~ "Dynasty Range",
      dynasty == "Dynasty 8–18" ~ "Dynasty Range",
      dynasty == "Dynasty 9?" ~ "Dynasty 9",
      dynasty == "Dynasty 9–12" ~ "Dynasty Range",
      dynasty == "Dynasty 18, early" ~ "Dynasty 18",
      dynasty == "original Dynasty 19" ~ "Dynasty 19",
      dynasty == "mid-Dynasty 18" ~ "Dynasty 18",
      dynasty == "late Dynasty 22" ~ "Dynasty 22",
      dynasty == "late Dynasty 21" ~ "Dynasty 21",
      dynasty == "late Dynasty 13-17" ~ "Dynasty Range",
      dynasty == "late Dynasty 13–17" ~ "Dynasty Range",
      dynasty == "late Dynasty 12–early Dynasty 13" ~ "Dynasty 12-13",
      dynasty == "late Dynasty 12–early  Dynasty 13" ~ "Dynasty 12-13",
      dynasty == "late Dynasty 12–Dynasty 13" ~ "Dynasty 12-13",
      dynasty == "late Dynasty 12–13" ~ "Dynasty 12-13",
      dynasty == "Probably Dynasty 1" ~ "Dynasty 1",
      dynasty == "Probably Dynasty 26" ~ "Dynasty 26",
      dynasty == "mid Dynasty 13" ~ "Dynasty 13",
      dynasty == "early Dynasty 18" ~ "Dynasty 18",
      dynasty == "dynasty 11" ~ "Dynasty 11",
      dynasty == "Late dynasty 11" ~ "Dynasty 11",
      dynasty == "Late Dynasty 21–early Dynasty 22" ~ "Dynasty 21-22",
      dynasty == "Late Dynasty 12–13" ~ "Dynasty 12-13",
      dynasty == "Dynasty 9–early Dnyasty 11" ~ "Dynasty Range",
      dynasty == "mid to late Dynasty 13" ~ "Dynasty 13",
      dynasty == "Dynasty 9–12" ~ "Dynasty Range",
      dynasty == "Second Intermediate Period" ~ "Dynasty Range",
      reign == "reign of Ramesses IV" ~ "Dynasty 20",
      reign == "reign of Sethnakht" ~ "Dynasty 20",
      object_date == "ca. 2649–1640 B.C." | object_name == "ca. 2649-1640 B.C." ~ "Dynasty Range",
      TRUE ~ dynasty,
      TRUE ~ reign,
      TRUE ~ object_date
    ),
    dynasty = ifelse(is.na(dynasty), "No Dynasty Specified", dynasty),
  dynasty = factor(dynasty, levels = c("Dynasty 1", "Dynasty 2", "Dynasty 3", "Dynasty 4", "Dynasty 5", "Dynasty 6", "Dynasty 8", "Dynasty 9", "Dynasty 11", "Dynasty 12", "Dynasty 12-13", "Dynasty 13", "Dynasty 14", "Dynasty 15", "Dynasty 17", "Dynasty 17-18", "Dynasty 18", "Dynasty 19", "Dynasty 19-20", "Dynasty 20", "Dynasty 21", "Dynasty 22", "Dynasty 23", "Dynasty 24", "Dynasty 25", "Dynasty 25-26", "Dynasty 26", "Dynasty 27", "Dynasty 30", "Dynasty Range", "No Dynasty Specified")))

```

### Object Accessioned by Dynasty Over Time
```{r}
met_egypt %>%
  group_by(dynasty, accession_year) %>%
  summarize(n = n()) |> 
  filter(!dynasty %in% c("Dynasty Range", "No Dynasty Specified")) |> 
  arrange(accession_year) |> 
  plot_ly(x = ~accession_year, y = ~n, 
          color = ~dynasty,  
          type = 'scatter', 
          mode = 'lines+markers', 
          colors = mypal) %>% 
  layout(
    title = "Artifacts Accessioned by Dynasty Over Time",
    xaxis = list(title = "Accession Year"),
    yaxis = list(title = "Number of Artifacts"),
    legend = list(title = "Dynasty"),
    showlegend = TRUE  # Set to TRUE if you want to display the legend
  )
```

### Histogram showing breakdown of the Dynasty's Represented in the Met
```{r}
met_egypt |> 
  plot_ly(x = ~dynasty, type = "histogram", color= ~dynasty, legendgroup = ~dynasty, showlegend= TRUE) %>%
  layout(
    title = "Histogram Plot", 
    xaxis = list(title = "Values"), 
    yaxis = list(title = "Frequency"))
  
met_egypt |> 
  plot_ly(x = ~reign, type = "histogram", color= ~reign, showlegend= TRUE) %>%
  layout(
    title = "Histogram Plot", 
    xaxis = list(title = "Values"), 
    yaxis = list(title = "Frequency"))
```

## Plot 2: Attempting an object creation timeline:

```{r}
dyn_26 = met_egypt |> 
  filter(dynasty %in% c("Dynasty 2", "Dynasty 6"))

# Create a timeline plot
met_egypt |> 
  mutate(
    year_created= (object_begin_date + object_end_date)/2
  ) |> 
  group_by(dynasty, year_created) |> 
  summarize(n_obs=n()) |> 
  plot_ly(x = ~year_created, y = ~n_obs, 
          color = ~dynasty,  
          type = 'scatter', 
          mode = 'lines+markers', 
          colors = mypal) %>% 
  layout(
    title = "Artifacts Approximate Creation Date by Dynasty Over Time",
    xaxis = list(title = "Approximate Creation Date"),
    yaxis = list(title = "Number of Artifacts"),
    legend = list(title = "Dynasty"),
    showlegend = TRUE  # Set to TRUE if you want to display the legend
  )


```

## Plot 3: Map

_Will play with this next_. Need to merge the country names with a country-level shapefile.

```{r}
met_subregions = met_egypt |>  
  filter(!(is.na(subregion))) |> 
  group_by(subregion) |> 
  summarize(artifact_number=n()) |> 
  filter(artifact_number>10)

met_subsub = met_egypt |>  
  filter(subregion %in% c("Abydos", "Amarna (Akhetaten)", "Asasif", "Deir el-Bahri", "Dra Abu el-Naga", "Hierakonpolis (Nekhen)", "Khokha", "Lisht North", "Lisht South", "Malqata", "Medinet Habu", "Oxyrhynchus (Bahnasa)", "Qantir (Piramesse)", "Saqqara", "Sheikh Abd el-Qurna", "Southern Asasif", "Tell Basta (Bubastis)",  "Valley of the Kings", "Wadi Gabbanat el-Qurud, Wadi D")) |> 
  group_by(dynasty, subregion) |> 
  summarize(artifact_number_dynasty=n())
  

met_subregions = met_subregions |> 
  mutate(
    latitude = c(26.1834, 27.6262, 25.733, 25.7373, 25.7369, 25.550, 25.42, 29.571, 29.570, 25.4255, 25.4311, 28.531, 30.8036, 29.8685, 25.7317, 25.7166, 30.5704, 25.7402, 25.7000),
    longitude= c(31.9226, 30.9852, 32.617, 32.6077, 32.6241, 32.4646, 32.28, 31.2318, 31.2318, 32.3528, 32.3603, 30.647, 31.8381, 31.2168, 32.6092, 32.6500, 31.5149, 32.6014, 32.5600)) |> 
     rowwise() |> 
  mutate(
    geometry = st_sfc(st_point(c(longitude, latitude)))
  )
  
met_egypt = 
  left_join(met_egypt, met_subregions, by= "subregion")
met_egypt = 
  left_join(met_egypt, met_subsub, by= c("subregion", "dynasty"))

egypt_shape <- st_read("data/EGY_adm1.shp")

egypt_map <- met_subregions |> 
  drop_na(latitude, longitude) |> 
  st_as_sf(coords = c("longitude", "latitude"), crs = st_crs(egypt_shape))

color_factor <- colorFactor(palette = mypal, domain = egypt_map$subregion)
brown_shades <- c("#8B4513", "#A0522D", "#CD853F", "#D2691E")
random_brown_shades <- replicate(nrow(egypt_shape), sample(brown_shades, 1))

met_subsub = left_join(met_subsub, met_subregions, by="subregion")
```


```{r}
# Create an interactive map using leaflet

combo_map <- leaflet() |> 
  
  # Add polygons from egypt_shape
  addPolygons(
    data = egypt_shape, 
    fillOpacity = 0.3, 
    fillColor= random_brown_shades,
    weight = 1, 
    color= "black",
    popup = ~NAME_1) |> 
  
  # Add point markers from egypt_map
  addCircleMarkers(
    data = met_subregions, 
    fillColor = ~color_factor(subregion), 
    radius = ~artifact_number/10, 
    popup = ~paste("Subregion: ", subregion, "<br>Total Artifacts: ", artifact_number),
    fillOpacity = 1.0,
    stroke = FALSE) |> 
  
  # Add a legend for the point markers
  addLegend("bottomright", colors = mypal[1:length(unique(egypt_map$subregion))], labels = unique(egypt_map$subregion), opacity = 0.5) |> 
  
  # Set the tile layer (you can choose a different one)
  addProviderTiles("Stamen.TonerLite")



# View the obtained coordinates
print(combo_map)
```

```{r}
egypt_shape <- st_read("data/EGY_adm1.shp")

ggplot() +
  geom_sf(data = egypt_shape, fill = "lightblue", color = "black") +
  labs(title = "Your Shapefile Map") +
  theme_minimal()
```

