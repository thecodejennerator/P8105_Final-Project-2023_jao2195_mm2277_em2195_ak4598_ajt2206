---
title: "plot ideas"
author: "Aleya Khalifa"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

library(tidyverse)
library(plotly)
library(leaflet)
```

## Import data

```{r, message = FALSE, warning=FALSE}
met_plot <- read_delim("/Users/aleya/Library/CloudStorage/OneDrive-cumc.columbia.edu/Coursework/Data Science I/data/MetObjects.txt") %>%  ## change this to a local call later
  janitor::clean_names() %>%
  select(object_id, object_name, title, accession_year,
         culture, period, department, is_highlight,
         geography_type, city, state, county, country, region, subregion) 


met_plot <- sample_n(met_plot, 5000) ## decide how much of the data to include, if too heavy
```

### Clean up the `object_name`

Note that the `object_name` variable can be more detailed than is necessary. Here, I try to create more general categories of objects.

```{r}
met_plot <- met_plot %>%
  mutate(object_name = ifelse(
    grepl("Textile", object_name), "Textile",
    ifelse(grepl("Painting", object_name), "Painting",
    ifelse(grepl("Relief", object_name), "Relief",
    ifelse(grepl("Print", object_name), "Print", 
           ifelse(grepl("aseball card", object_name), "Baseball card", 
                  ifelse(grepl("Vase", object_name), "Vase", 
                         ifelse(grepl("rnament", object_name), "Vase", 
                                ifelse(grepl("arring", object_name), "Earring", 
                                       ifelse(grepl("ecklace", object_name), "Necklace", 
                                              ifelse(grepl("hotograph", object_name), "Photograph", 
                                                     ifelse(grepl("tatue", object_name), "Statue", 
           object_name))))))))))))
```

### Data checks

Note: substantial missingness for the geography variables. We may want to limit the data to just those with geographic data, but it would be a biased picture. The variable `accession_year` however, has high completeness! And `culture` has moderate completeness. Here is a table of the % rows with missing values by selected column:

```{r}
sapply(met_plot, function(x) sum(is.na(x))/5000)
```

## Set color palette based on Wes Anderson package

```{r}
mypal<-c("#78B7C5",  "#EBCC2A", "#FF0000", "#EABE94", 
         "#3B9AB2", "#B40F20", "#0B775E", "#F2300F", 
         "#5BBCD6", "#F98400", "#ab0213", "#E2D200", 
         "#ff7700", "#46ACC8", "#00A08A", "#78B7C5",
         "#a7ba42", "#f94f8a", "#DD8D29")
```

## Plot 1: Line chart showing number of objects acquired by department over time

```{r}
met_plot %>%
  group_by(department, accession_year) %>%
  summarize(n = n()) %>%
  plot_ly(x = ~accession_year, y = ~n, 
          color = ~department,  
          type = 'scatter', 
          mode = 'lines+markers', 
          colors = mypal) %>% 
  layout(showlegend = FALSE)
  
```

## Plot 2: Most popular object types by department

Could also do this by year, or by culture. 

```{r}
top_5 <- met_plot %>%
  group_by(department, accession_year) %>%
  count(object_name) %>%
  filter(n > 1)

plot2 <- ggplot(top_5, mapping = aes(x = accession_year, y = n, 
                                     color = department, size = 100*n,
                                     label = department, label2 = object_name, label3 = n)) + 
  geom_jitter(alpha=0.5, position = position_jitter(width = 0.4)) +
  scale_color_manual(values = mypal) +
  theme(axis.text.x = element_text(angle = 35, hjust = 1),
        legend.position = "none")+
  labs(title="Popular objects by department, over time",
       y = "Number of objects", x = "Department")

plotly2 <- ggplotly(plot2)
plotly2
```

## Plot 3: Map

_Will play with this next_. Need to merge the country names with a country-level shapefile.

```{r}
met_plot %>% 
  filter(!is.na(country)) %>%
  leaflet() %>%
  addTiles()
```

